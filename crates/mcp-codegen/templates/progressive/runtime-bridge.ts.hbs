/**
 * MCP Bridge Runtime
 *
 * Provides runtime helpers for calling MCP tools via the mcp-cli bridge.
 *
 * ## Overview
 *
 * This module acts as the runtime bridge between generated TypeScript code
 * and the actual MCP server. All tool calls go through `callMCPTool()`,
 * which communicates with the MCP server via the mcp-cli bridge command.
 *
 * ## Implementation Status
 *
 * The bridge command will be implemented in Phase 2.3 of the progressive
 * loading pivot. For now, this provides the type-safe interface that
 * generated tools will use.
 *
 * @packageDocumentation
 */

/**
 * Calls an MCP tool via the bridge command.
 *
 * This function communicates with the mcp-cli bridge to execute MCP tools.
 * It handles serialization of parameters, execution of the tool, and
 * deserialization of results.
 *
 * @param serverId - MCP server identifier (e.g., "github", "google-drive")
 * @param toolName - Tool name to call (e.g., "create_issue")
 * @param params - Tool parameters (will be serialized to JSON)
 * @returns Tool execution result
 * @throws {Error} If tool execution fails or bridge is not available
 *
 * @example
 * ```typescript
 * const result = await callMCPTool('github', 'create_issue', {
 *   repo: 'owner/repo',
 *   title: 'Bug report',
 *   body: 'Description'
 * });
 * ```
 */
export async function callMCPTool(
  serverId: string,
  toolName: string,
  params: unknown
): Promise<unknown> {
  // TODO: Phase 2.3 - Implement bridge command
  // This will execute: mcp-cli bridge call <serverId> <toolName> <params>
  // For now, this is a placeholder that will be implemented when
  // CLI bridge command is added

  throw new Error(
    `callMCPTool not yet implemented. ` +
    `Attempted to call ${serverId}:${toolName} with params: ${JSON.stringify(params)}`
  );
}

/**
 * Type guard to check if a value is an error response.
 *
 * @param value - Value to check
 * @returns True if value represents an error
 */
function isErrorResponse(value: unknown): value is { error: string } {
  return (
    typeof value === 'object' &&
    value !== null &&
    'error' in value &&
    typeof (value as { error: unknown }).error === 'string'
  );
}
